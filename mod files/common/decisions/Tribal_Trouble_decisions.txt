#A more lenient decision to convert if your liege is feudal
convert_to_feudalism_liege_converted_decision = { #by Linnéa Thimrén
	picture = "gfx/interface/illustrations/decisions/decision_realm.dds"
	major = yes
	desc = convert_to_feudalism_liege_converted_decision_desc

	ai_check_interval = 36

	is_shown = {
		always = no
	}

	is_valid = {
		OR = {
			has_realm_law = tribal_authority_1
			has_realm_law = tribal_authority_2
			has_realm_law = tribal_authority_3
		}
		custom_description = {
			text = faith_is_reformed
			subject = root
			faith = { NOT = { has_doctrine_parameter = unreformed } }
		}
	}

	cost = {
		prestige = 150
	}

	effect = {
		trigger_event = major_decisions.0001
		save_scope_as = actor
		convert_whole_realm_to_feudalism_effect = yes
		hidden_effect = {
			every_vassal = {
				trigger_event = {
					id = major_decisions.0002
					days = 3
				}
			}
		}
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 0
	}
}

#A decision to feudalize the entire realm (wow!)
convert_whole_realm_to_feudalism_decision = { #by Linnéa Thimrén
	picture = "gfx/interface/illustrations/decisions/decision_realm.dds"
	major = yes
	desc = convert_whole_realm_to_feudalism_decision_desc

	ai_check_interval = 36

	is_shown = {
		always = no
	}

	is_valid = {
		has_realm_law = tribal_authority_3
		custom_description = {
			text = faith_is_reformed
			subject = root
			faith = { NOT = { has_doctrine_parameter = unreformed } }
		}
		prestige_level >= 2
		capital_province.county = {
			development_level >= convert_to_feudalism_development_requirement
		}

		custom_description = { #You need to have 70% of all (non-regional/unique) tribal innovations!
			text = has_all_tribal_innovations
			subject = root.culture
			culture = {
				calc_true_if = {
					amount >= 9
					has_innovation = innovation_motte
					has_innovation = innovation_catapult
					has_innovation = innovation_barracks
					has_innovation = innovation_mustering_grounds
					has_innovation = innovation_bannus
					has_innovation = innovation_quilted_armor
					has_innovation = innovation_gavelkind
					has_innovation = innovation_crop_rotation
					has_innovation = innovation_city_planning
					has_innovation = innovation_casus_belli
					has_innovation = innovation_plenary_assemblies
					has_innovation = innovation_ledger
					has_innovation = innovation_development_01
					has_innovation = innovation_currency_01
				}
			}
		}
	}

	cost = {
		prestige = 200
	}

	effect = {
		trigger_event = major_decisions.0001
		save_scope_as = actor
		convert_whole_realm_to_feudalism_effect = yes
		hidden_effect = {
			every_vassal = {
				trigger_event = {
					id = major_decisions.0002
					days = 3
				}
			}
		}
	}

	ai_potential = {
		NOT = { has_title = title:e_mongol_empire } #Stop the Mongols from slowing their conquest.
	}

	ai_will_do = {
		base = 0
	}
}

found_kingdom_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_dynasty_house.dds"
	major = yes
	ai_check_interval = 60
	desc = found_kingdom_decision_desc

	is_shown = {
		highest_held_title_tier = tier_duchy
		NOT = { has_game_rule = off_custom_kingdoms }
		trigger_if = {
			limit = { has_government = tribal_government }
			has_realm_law = tribal_legitimacy_de_jure
		}
	}

	is_valid = {
		prestige_level >= 3
		is_independent_ruler = yes
		OR = {
			custom_description = {
				text = found_kingdom_decision_three_duchies_held
				any_held_title = {
					count > 2
					tier = tier_duchy
				}
			}
			sub_realm_size >= 30
		}
	}

	is_valid_showing_failures_only = {
		is_available_adult = yes
		is_at_war = no
	}

	cost = {
		gold = 300
		prestige = 500
		piety = 200
	}

	effect = {
		create_custom_kingdom_effect = yes
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

found_empire_decision = {
	picture = "gfx/interface/illustrations/decisions/decision_dynasty_house.dds"
	major = yes
	ai_check_interval = 60
	desc = found_empire_decision_desc

	is_shown = {
		highest_held_title_tier = tier_kingdom
		OR = {
			is_independent_ruler = yes
			any_held_title = {
				count >= 3
				tier = tier_kingdom
			}
		}
		NOT = { has_game_rule = off_custom_kingdoms }
		trigger_if = {
			limit = { has_government = tribal_government }
			has_realm_law = tribal_legitimacy_de_jure
		}
	}

	is_valid = {
		prestige_level >= 4
		OR = {
			sub_realm_size >= 120
			AND = {
				custom_description = {
					text = found_empire_decision_three_kingdoms_held
					any_held_title = {
						count >= 3
						tier = tier_kingdom
					}
				}
				sub_realm_size >= 80
			}
		}
	}

	is_valid_showing_failures_only = {
		is_independent_ruler = yes
		is_available_adult = yes
		is_at_war = no
	}

	cost = {
		gold = 1200
		prestige = 2000
		piety = 600
	}

	effect = {
		create_custom_empire_effect = yes
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

adopt_special_succession_decision = { #by Ewan Cowhig Croft
	picture = "gfx/interface/illustrations/decisions/decision_dynasty_house.dds"
	desc = adopt_special_succession_decision_desc

	ai_check_interval = 36

	is_shown = {
		OR = {	#Must be eligible for a special succession type.
			special_succession_witengamot_trigger = yes
			special_succession_thing_trigger = yes
			special_succession_tanistry_trigger = yes
		}
		AND = {
			highest_held_title_tier >= tier_kingdom
			has_realm_law_flag = partition_succession_law
			any_held_title = {
				tier >= tier_kingdom
				NOR = {
					has_title_law_flag = advanced_succession_law
					has_title_law_flag = elective_succession_law
				}
			}
		}
		current_date < 1100.1.1	#Curtail special succession types as the centuries wear on. Ever on.
		trigger_if = {
			limit = { has_government = tribal_government }
			has_realm_law = tribal_inheritance_succession
		}
	}

	is_valid = {
		trigger_if = {
			limit = { highest_held_title_tier = tier_kingdom }
			#Either hold a valid top-tier king title as a king...
			AND = {
				any_held_title = {
					tier = tier_kingdom
					NOR = {
						custom_description = {
							text = found_kingdom_decision_advanced_succesion
							has_title_law_flag = advanced_succession_law
						}
						custom_description = {
							text = found_kingdom_decision_elective_succesion
							has_title_law_flag = elective_succession_law
						}
					}
				}
			}
		}
		trigger_else = {
			#... Or a valid top-tier empire title as an emperor.
			AND = {
				highest_held_title_tier >= tier_empire
				any_held_title = {
					tier >= tier_empire
					NOR = {
						custom_description = {
							text = found_kingdom_decision_advanced_succesion
							has_title_law_flag = advanced_succession_law
						}
						custom_description = {
							text = found_kingdom_decision_elective_succesion
							has_title_law_flag = elective_succession_law
						}
					}
				}
			}
		}
		trigger_if = {
			limit = { has_government = tribal_government }
			has_realm_law = tribal_legitimacy_de_jure
		}
	}

	cost = {
		prestige = 300
	}

	effect = {
		show_as_tooltip = {
			custom_tooltip = adopt_special_succession_decision_effects.tt
		}
		trigger_event = major_decisions.3100
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = 100
	}
}

secede_from_empire_decision = { #by Sean Hughes
	picture = "gfx/interface/illustrations/decisions/decision_misc.dds"
	desc = secede_from_empire_decision_desc
	selection_tooltip = secede_from_empire_decision_tooltip

	ai_check_interval = 12

	is_shown = {
		liege = {
			highest_held_title_tier = tier_empire
			NOT = { this = root }
			OR = {
				liege = { debt_level >= 7 } # Over 25 years in debt
				liege = {
					any_character_war = {
						primary_attacker = prev
						war_days >= 7300 # Offensive war lasting over 25 years.
					}
				}	
			}
		}
	}

	is_valid = {
		OR = {
			custom_description = {
				liege = { debt_level >= 7 } # Over 25 years in debt
				subject = liege
				object = root
				text = secede_from_empire_decision_trigger_debt
			}
			custom_description = {		
				liege = {
					any_character_war = {
						primary_attacker = prev
						war_days >= 7300 # Offensive war lasting over 25 years.
					}
				}
				subject = liege
				object = root
				text = secede_from_empire_decision_trigger_war
			}
		}
	}

	is_valid_showing_failures_only = {
		is_available = yes
	}

	effect = {
		# Liege loses debt proportionally to how much realm_size they will lose when you go independent.
		custom_tooltip = secede_from_empire_decision_effect_tooltip
		hidden_effect = {
			liege = {
				save_scope_as = liege
				save_scope_value_as = {
					name = debt_cleared
					value = {
						value = gold 						# Example: I am 1000 gold in debt, so we start with -1000
						multiply = root.sub_realm_size 		# The seceeding vassal has a realm size of 25...
						divide = scope:liege.realm_size 			# ...while the top liege has a realm size of 100, scaling the value to -250
						multiply = -1.1 	
					}
				}
				send_interface_toast = {
					title = secede_from_empire_decision_notification
					left_icon = root

					custom_tooltip = secede_from_empire_decision_notification_tt
					add_gold = scope:debt_cleared
				}
			}
		}

		# Go independent
		create_title_and_vassal_change = {
			type = independency 
			save_scope_as = change
		}
		becomes_independent = {
			change = scope:change
		}
		resolve_title_and_vassal_change = scope:change
		# [Tribal Trouble]
		save_scope_as = new_tribe_leader
		if = {
			limit = { any_relation = { type = tribe_leader }}
			every_relation = { type = tribe_leader remove_relation_tribe_member = PREV }
		}
		ordered_vassal_or_below = {
			order_by = highest_held_title_tier
			max = 1000
			check_range_bounds = no
			limit = {
				trigger_if = {
					limit = { NOT = { liege = scope:new_tribe_leader }}
					liege = {
						any_relation = { type = tribe_leader THIS = scope:new_tribe_leader }
						has_government = tribal_government
					}
				}
			}
			scope:new_tribe_leader = { set_relation_tribe_member = PREV }
		}
		# [/Tribal Trouble]
		debug_log = "Empire Vassal Secession:"
		debug_log_scopes = no
		scope:liege = { debug_log_scopes = no }
		scope:debt_cleared = { debug_log_scopes = no }
	}
	
	ai_potential = {
		liege = { debt_level >= 5 } # More than 5 years in debt
		trigger_if = {
			limit = {
				is_rightful_liege_of_trigger = {
					LIEGE = liege
					VASSAL = root
				}
			}
			is_powerful_vassal = yes # The strongest vassals go first
			highest_held_title_tier >= tier_county # Counts should never break away from their rightful liege, though.
		}
		trigger_else = {
			liege = { is_ai = yes }

			# Slightly different from the rightful liege check, this looks to see if I hold any land at all that De Jure belongs to my liege's empire(s).
			NOT = {	
				any_held_title = {
					tier = tier_county
					exists = empire.holder
					empire.holder = root.liege
				}
			}
		}
	}

	ai_will_do = {
		base = -40

		# Realm Modifiers
		compare_modifier = {
			value = sub_realm_size
			multiplier = 1
		}

		modifier = {
			add = 50
			NOT = {
				is_rightful_liege_of_trigger = {
					LIEGE = liege
					VASSAL = root
				}
			}
		}

		modifier = {
			# Kings are more likely to seceede
			add = 25
			highest_held_title_tier = tier_kingdom
		}

		modifier = {
			add = -35
			# Electors in the HRE are far less likely to seceede.
			liege.primary_title = title:e_hre
			title:e_hre = {
				has_title_law = princely_elective_succession_law
				any_elector = {
					this = root
				}
			}
		}

		modifier = {
			add = -60 
			# Satraps of the Mongol Empire should (almost) never seceede.
			liege.primary_title = title:e_mongolia  
		}

		# 'Soft' Modifiers, e.g., Opinion and Personality
		ai_value_modifier = {
			ai_greed = 0.35
			ai_boldness = 0.35
		}

		opinion_modifier = {
			opinion_target = liege
			who = root
			multiplier = -0.15
		}

		# Faith and Culture Factors
		modifier = {
			factor = 1.2
			NOT = { culture_group = liege.culture_group }
		}

		modifier = {
			factor = 1.1
			faith = {		
				faith_hostility_level = {
					target = root.liege.faith
					value = faith_astray_level
				}
			}
		}

		modifier = {
			factor = 1.3
			faith = {		
				faith_hostility_level = {
					target = root.liege.faith
					value = faith_hostile_level
				}
			}
		}

		modifier = {
			factor = 1.5
			faith = {		
				faith_hostility_level = {
					target = root.liege.faith
					value = faith_evil_level
				}
			}
		}
	}	
}

feudalization_test = { #by Linnéa Thimrén
	picture = "gfx/interface/illustrations/decisions/decision_misc.dds"
	major = yes
	desc = convert_whole_realm_to_feudalism_decision_desc

	ai_check_interval = 12

	is_shown = {
		has_government = tribal_government
		is_independent_ruler = yes
	}

	is_valid = {

	}

	cost = {
		prestige = 200
	}

	effect = {
		trigger_event = Tribal_Trouble_feudalization_decision.0001
		debug_log = "dbg_log // Tribal Trouble // Decision // feudalization_test"
		debug_log_scopes = no
	}

	ai_potential = {
		always = yes
	}

	ai_will_do = {
		base = -69
		modifier = {
			add = {
				add = feudalization_progress
				multiply = 100
			}
		}
		modifier = {
			add = {
				add = ai_boldness
				divide = 5
			}
		}
	}
}